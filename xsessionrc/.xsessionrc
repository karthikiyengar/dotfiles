#!bin/bash
if [[ "$DESKTOP_SESSION" == *"xmonad"* ]] 
then
  # enable compositing
  # compton --backend glx --xrender-sync --xrender-sync-fence -fCz --fade-delta 4 &!
  picom --fade-delta 3 -CfGb

  # screen lock daemon
  
  # Run xidlehook
  xidlehook \
  `# Don't lock when there's a fullscreen application` \
  --not-when-fullscreen \
  `# Don't lock when there's audio playing` \
  --not-when-audio \
  `# Dim the screen after 60 seconds, undim if user becomes active` \
  --timer 60 \
    'xrandr --output "eDP-1" --brightness .3' \
    'xrandr --output "eDP-1" --brightness 1' \
  `# Undim & lock after 10 more seconds` \
  --timer 10 \
    'xrandr --output "eDP-1" --brightness 1; slock' \
    '' \
  `# Finally, suspend 30 mins after it locks` \
  --timer 900 \
    'systemctl suspend' \
    '' &!
  
  # Applets
  nm-applet &!
  pasystray &!
  blueman-applet &!
  greenclip daemon &!
  # mullvad-vpn &
  rumno-background &!
  
  # Set cursor to pointer
  xsetroot -cursor_name left_ptr &!
  
  # Load custom fonts
  xset +fp $HOME/.local/share/fonts
  xset fp rehash &!
  
  # Set the correct xrandr settings
  autorandr -c &!
  
  # Set Wallpaper
  if [ -f ~/.wallpapers/current-wallpaper.jpg ]; then
    feh --bg-scale ~/.wallpapers/current-wallpaper.jpg
  else
    feh --bg-scale ~/.wallpapers/dark-space.jpg
  fi
 
  if [ -x "$(command -v nextcloud)" ]; then
    nextcloud --background &!
  fi

  flatpak run ch.protonmail.protonmail-bridge --no-window &!
  rumno-background &!
  # Set touchpad settings
  ~/.wm-scripts/touchpad-settings.sh  
  
  ~/.wm-scripts/change-wallpaper.sh &!
fi
